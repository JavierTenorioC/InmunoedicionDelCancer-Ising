#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Feb  8 16:34:47 2024

@author: jatec
"""

from mesa import *
from cancerInmunoediting.model import CancerInmunoediting
import pandas as pd
import numpy as np
import os


# Fase de eliminación
# title = "elim"
# res = [-1714.6180000000002, -1914.8056, -1724.2764000000002, -1290.16, -1393.1804000000002, -1592.7764000000002, -1748.7179999999998, -1884.8020000000001, -1919.0639999999999, -1959.326, -1969.9940000000001, -1961.2060000000001, -1946.8048000000001, -1898.04, -1900.046, -1846.6388, -1818.6804000000002, -1794.7896000000003, -1751.2564000000002, -1727.0224000000003, -1548.2384, -1629.89, -1517.8524, -1491.4956, -1426.8080000000002, -1401.854, -1336.9376000000002, -1172.8992, -1016.1236, -1031.2448, -1157.626, -1114.5764, -1093.3712, -1066.0452, -956.6876000000001, -921.1884, -879.9944, -793.0464000000002, -729.5308, -743.5636, -701.7280000000001, -646.3996000000001, -652.318, -610.7304, -526.6132, -436.54119999999995, -412.51480000000004, -400.5412, -326.07880000000006, -220.5736, -257.884, -266.70279999999997, -260.23, -213.5408, -209.5312, -179.56919999999994, -283.61120000000005, -198.67559999999997, -192.4556, -149.23560000000003, -121.50600000000003, -158.29600000000002, -219.75200000000004, -217.87800000000007, -140.71280000000002, -187.19960000000003, -103.05800000000005, -171.75560000000002, -225.4804, -200.04840000000002, -198.99719999999996, -214.674, -171.8416, -160.65200000000002, -182.1968, -130.72680000000003, -125.38840000000002, -158.7608, -158.1696, -164.2412, -162.4572, -132.9944, -122.30160000000002, -115.1212, -102.30040000000002, -98.76240000000001, -99.8804, -99.33439999999999, -109.022, -105.41120000000001, -111.03119999999998, -137.50039999999998, -142.8628, -134.2944, -127.36280000000002, -173.87040000000002, -166.9028, -152.14720000000003, -159.774, -130.8604]
# mu1 = 0.7
# sigma1 = 0.05
# mu2 = 0.3
# sigma2 = 0.05

# Fase de equilibrio
# title = "equil"
# res = [-138.2544, -134.4416, -129.8488, -116.38719999999999, -106.14040000000001, -112.7376, -113.5952, -115.6796, -112.19040000000001, -114.32520000000001, -115.94800000000001, -125.09200000000001, -119.70480000000002, -117.5116, -119.05040000000001, -114.2872, -115.24719999999999, -115.53720000000001, -116.93360000000001, -116.43360000000001, -115.14040000000001, -114.14480000000002, -119.55239999999999, -126.39280000000001, -126.9932, -131.0232, -125.39400000000002, -118.7968, -122.3648, -120.71719999999999, -123.1768, -123.36, -124.1812, -123.9412, -128.482, -126.7968, -130.126, -129.368, -129.484, -125.9076, -127.9816, -128.7584, -128.5824, -132.3356, -132.41920000000002, -131.4376, -131.81160000000003, -127.4932, -130.5008, -128.90120000000002, -128.77280000000002, -125.3548, -124.124, -124.4144, -129.2516, -127.9392, -131.43, -132.11440000000002, -128.4672, -126.2792, -124.0892, -123.23080000000002, -121.97400000000002, -115.92720000000001, -111.75, -110.0724, -102.5316, -102.5784, -99.94879999999999, -98.51, -93.9724, -93.652, -101.35, -96.7536, -95.9684, -92.5008, -88.5624, -86.6048, -83.792, -89.042, -86.31639999999999, -86.7292, -85.3208, -80.3708, -76.9324, -75.52600000000001, -74.0108, -71.35600000000001, -67.04480000000001, -63.7764, -68.194, -62.274800000000006, -63.86879999999999, -65.96879999999999, -64.9292, -57.5384, -51.033199999999994, -49.0784, -50.303599999999996, -50.8684]
# mu1 = 0.3
# sigma1 = 0.05
# mu2 = 0.15
# sigma2 = 0.05

# # Fase de escape
title = "escape"
res = [1154.7956, 1259.0888, 1358.0423999999998, 1447.9028, 1563.2676000000001, 1597.5696000000003, 1667.8152000000002, 1607.6844, 1492.9312, 1553.9528, 1539.8612, 1609.2279999999998, 1668.3564, 1730.6384, 1772.9728, 1804.2907999999998, 1847.9923999999999, 1886.5848, 1951.1760000000002, 1991.6136, 2045.0116, 2103.8924, 2137.1232, 2180.1272, 2171.6888, 2172.1564, 2170.8576000000003, 2135.9267999999997, 2140.9452, 2145.3168, 2114.6588, 2155.4592000000002, 2135.5712, 2116.4276, 2193.5176, 2217.6076000000003, 2222.3296, 2187.5628, 2200.2992, 2196.4184, 2208.5764, 2193.7128, 2187.54, 2171.62, 2142.0292, 2130.6588, 2085.0208000000002, 2065.2668, 2030.1112, 1975.5067999999999, 2003.4756, 2001.4536, 1983.2656, 1941.412, 1990.582, 2004.5476, 1991.8836000000001, 1998.7256, 2065.2428, 2055.4364, 2022.75, 1948.4532000000002, 1906.4995999999999, 1896.994, 1862.6236000000001, 1842.6016, 1860.1284, 1869.0508, 1851.9532000000002, 1793.3164000000002, 1811.2060000000001, 1783.3872000000001, 1743.1272, 1740.2051999999999, 1706.256, 1666.2204000000002, 1619.9144000000001, 1583.2432000000001, 1538.0156, 1499.7723999999998, 1509.9596, 1480.3188, 1457.7132000000001, 1455.2060000000001, 1479.0772, 1469.6328, 1529.7644, 1525.7076000000002, 1523.5388, 1499.3236, 1485.2948000000001, 1477.7204000000002, 1484.6752, 1515.9268, 1491.7795999999998, 1507.138, 1517.8080000000002, 1532.9628, 1534.3324, 1538.1228]
mu1 = 0.4
sigma1 = 0.05
mu2 = 0.6
sigma2 = 0.05

maxAge = 10
maxCells = 100
maxCellsRecruit = 100
maxCellsActivate = 100
maxCellsDeactivate = 100
iniciales = [
    initialCancerCells := abs(int(np.random.normal(mu2,sigma2)*100)),
    initialNaturalKillers := abs(int(np.random.normal(mu1,sigma1)*100)),
    initialMacrofagues := abs(int(np.random.normal(mu1,sigma1)*100)),
    initialNeutrophils := abs(int(np.random.normal(mu1,sigma1)*100)),
    int(np.random.normal(mu1,sigma1)*100),
    int(np.random.normal(mu1,sigma1)*100),
    int(np.random.normal(mu1,sigma1)*100),
   
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu1,sigma1)*100)),
    abs(int(np.random.normal(mu2,sigma2)*100)),
    abs(int(np.random.normal(mu2,sigma2)*100)),
    
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu2,sigma2)*10)),
    abs(int(np.random.normal(mu2,sigma2)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    
    abs(int(np.random.normal(mu1/(mu1 + mu2),sigma1)*100)),
    abs(int(np.random.normal(mu1/(mu1 + mu2),sigma1)*100)),
    
    abs(int(maxCellsDeactivate * np.random.normal(mu1,sigma1))),
    abs(int(maxCellsDeactivate * np.random.normal(mu1,sigma1))),

    abs(int(maxCellsActivate * np.random.normal(mu2,sigma2))),
    abs(int(maxCellsActivate * np.random.normal(mu2,sigma2))),
    
    abs(np.random.normal(mu1,sigma1)*100),
    
    abs(np.random.normal(mu2,sigma2)*100),
    
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10)),
    abs(int(np.random.normal(mu1,sigma1)*10))
    ]


# # Fase de eliminación
# # pro tumoral
#  [65.28, 69.0, 72.16, 76.24, 77.36, 79.88, 79.84, 78.8, 80.52, 80.52, 82.56, 84.8, 87.28, 89.48, 91.04, 93.4, 94.64, 96.68, 98.64, 100.28, 101.96, 103.44, 104.68, 105.8, 106.68, 107.0, 106.76, 107.4, 108.12, 107.84, 109.2, 110.04, 110.12, 112.28, 113.84, 114.92, 115.16, 115.96, 117.0, 117.72, 117.76, 118.12, 118.04, 118.04, 117.72, 116.2, 115.6, 114.88, 113.8, 113.92, 114.08, 113.88, 113.16, 113.84, 113.32, 112.92, 112.88, 114.04, 114.64, 114.24, 113.08, 111.4, 110.44, 109.64, 109.72, 109.84, 109.72, 109.52, 108.28, 108.2, 107.08, 106.44, 106.64, 107.04, 105.68, 104.76, 104.36, 102.28, 101.4, 100.84, 100.0, 100.12, 99.88, 99.8, 100.44, 101.92, 102.28, 102.44, 102.48, 103.48, 103.92, 104.68, 105.56, 105.84, 106.56, 107.12, 107.76, 108.32, 109.12, 108.92],
# # anti tumoral
#  [114.12, 110.8, 107.56, 103.6, 98.8, 95.64, 92.36, 89.36, 84.96, 82.2, 78.16, 75.76, 73.2, 70.36, 68.76, 66.4, 64.96, 62.52, 59.52, 58.12, 56.08, 54.72, 53.88, 53.52, 52.6, 52.28, 51.2, 50.2, 49.28, 48.44, 46.32, 45.44, 44.96, 43.32, 41.48, 40.12, 40.16, 39.2, 39.16, 38.12, 37.2, 36.76, 36.48, 36.12, 35.48, 34.84, 33.88, 34.2, 34.16, 32.96, 32.8, 31.8, 31.52, 30.36, 30.44, 30.12, 29.84, 28.8, 29.24, 29.88, 30.28, 30.12, 29.96, 30.16, 29.8, 28.76, 28.4, 28.12, 28.2, 27.92, 28.08, 28.36, 28.28, 28.16, 27.16, 27.6, 28.2, 27.8, 27.72, 27.32, 27.36, 27.2, 27.2, 26.76, 26.92, 26.2, 26.32, 26.04, 26.04, 26.4, 26.68, 26.76, 26.04, 26.52, 26.32, 26.48, 26.12, 26.6, 26.56, 26.56],
# # hamiltoniano
# # htme
#  [-1714.6180000000002, -1914.8056, -1724.2764000000002, -1290.16, -1393.1804000000002, -1592.7764000000002, -1748.7179999999998, -1884.8020000000001, -1919.0639999999999, -1959.326, -1969.9940000000001, -1961.2060000000001, -1946.8048000000001, -1898.04, -1900.046, -1846.6388, -1818.6804000000002, -1794.7896000000003, -1751.2564000000002, -1727.0224000000003, -1548.2384, -1629.89, -1517.8524, -1491.4956, -1426.8080000000002, -1401.854, -1336.9376000000002, -1172.8992, -1016.1236, -1031.2448, -1157.626, -1114.5764, -1093.3712, -1066.0452, -956.6876000000001, -921.1884, -879.9944, -793.0464000000002, -729.5308, -743.5636, -701.7280000000001, -646.3996000000001, -652.318, -610.7304, -526.6132, -436.54119999999995, -412.51480000000004, -400.5412, -326.07880000000006, -220.5736, -257.884, -266.70279999999997, -260.23, -213.5408, -209.5312, -179.56919999999994, -283.61120000000005, -198.67559999999997, -192.4556, -149.23560000000003, -121.50600000000003, -158.29600000000002, -219.75200000000004, -217.87800000000007, -140.71280000000002, -187.19960000000003, -103.05800000000005, -171.75560000000002, -225.4804, -200.04840000000002, -198.99719999999996, -214.674, -171.8416, -160.65200000000002, -182.1968, -130.72680000000003, -125.38840000000002, -158.7608, -158.1696, -164.2412, -162.4572, -132.9944, -122.30160000000002, -115.1212, -102.30040000000002, -98.76240000000001, -99.8804, -99.33439999999999, -109.022, -105.41120000000001, -111.03119999999998, -137.50039999999998, -142.8628, -134.2944, -127.36280000000002, -173.87040000000002, -166.9028, -152.14720000000003, -159.774, -130.8604],
# # pro tumoral
#  [0.0, 80.36399999999999, 137.77, 86.9992, 98.94, 123.0376, 137.3042, 150.732, 166.63400000000001, 198.3664, 224.0564, 233.015, 246.2682, 256.7082, 280.2564, 284.3772, 292.131, 296.20439999999996, 293.68839999999994, 314.7124, 394.094, 335.93120000000005, 385.14239999999995, 369.3592, 384.5592, 373.9768, 387.80080000000004, 459.1864, 489.9964, 455.5994, 365.7104, 362.11879999999996, 353.7752, 352.2872, 384.85580000000004, 349.19660000000005, 348.26, 379.58, 393.4056, 369.2758, 362.8456, 379.10400000000004, 340.9532, 332.5772, 355.1304, 376.5588, 370.9116, 352.0434, 384.05479999999994, 418.35760000000005, 377.0916, 349.23519999999996, 335.2428, 354.6768, 341.18760000000003, 338.7112, 272.61240000000004, 311.5088, 299.5868, 313.584, 319.8592, 298.8252, 261.72819999999996, 238.88979999999995, 283.6268, 262.0222, 294.64279999999997, 253.05939999999998, 201.77700000000002, 194.27700000000002, 191.6378, 176.55079999999998, 199.1978, 195.2636, 172.4512, 196.8684, 191.81759999999997, 172.3936, 180.0816, 170.66760000000002, 167.78119999999998, 171.7062, 176.138, 169.3966, 175.78099999999998, 165.91400000000002, 152.78519999999997, 148.844, 139.2062, 137.8, 140.37959999999998, 123.6124, 126.2208, 136.7448, 142.4844, 118.24259999999998, 125.0582, 132.4476, 129.6724, 149.8314],
# # anti tumoral
#  [-1714.6180000000002, -1995.1696, -1862.0464000000002, -1377.1592, -1492.1204, -1715.8139999999999, -1886.0222, -2035.5339999999999, -2085.6980000000003, -2157.6924000000004, -2194.0504, -2194.221, -2193.0730000000003, -2154.7482, -2180.3024, -2131.016, -2110.8114, -2090.994, -2044.9448000000002, -2041.7348000000002, -1942.3324, -1965.8211999999999, -1902.9948000000002, -1860.8548, -1811.3672, -1775.8308000000002, -1724.7384, -1632.0855999999999, -1506.12, -1486.8442000000002, -1523.3364000000001, -1476.6952, -1447.1464, -1418.3324000000002, -1341.5434, -1270.385, -1228.2544, -1172.6264, -1122.9364, -1112.8394, -1064.5736, -1025.5036, -993.2711999999999, -943.3076, -881.7436, -813.1, -783.4264, -752.5846, -710.1336, -638.9312, -634.9756, -615.938, -595.4728, -568.2176000000001, -550.7188, -518.2804, -556.2236, -510.1843999999999, -492.0424, -462.8196, -441.3652, -457.12120000000004, -481.4802, -456.76779999999997, -424.3396, -449.22180000000003, -397.7008, -424.81500000000005, -427.25739999999996, -394.3254, -390.635, -391.22479999999996, -371.0394, -355.91560000000004, -354.648, -327.5952, -317.20599999999996, -331.1544, -338.2511999999999, -334.9088, -330.23839999999996, -304.7006, -298.4396, -284.51779999999997, -278.0814, -264.6764, -252.66559999999998, -248.1784, -248.2282, -243.2112, -251.41080000000002, -261.1128, -269.0836, -271.0392, -269.8472, -292.113, -291.961, -284.5948, -289.44640000000004, -280.6918],

# # Fase de equilibrio
# # pro tumoral
#  [30.56, 26.44, 16.56, 17.52, 20.12, 21.48, 22.92, 24.52, 26.44, 28.08, 28.56, 29.32, 30.0, 31.4, 31.56, 32.48, 33.16, 33.0, 34.6, 34.92, 35.52, 36.44, 36.24, 36.56, 36.28, 36.64, 36.96, 35.96, 35.56, 34.72, 34.6, 34.4, 34.56, 34.28, 32.68, 32.12, 32.4, 32.4, 32.28, 31.4, 31.36, 30.16, 29.28, 28.48, 27.76, 27.28, 26.2, 25.88, 25.16, 24.4, 23.92, 23.32, 23.68, 23.12, 22.48, 22.0, 21.84, 21.44, 21.12, 20.84, 20.84, 20.6, 19.0, 19.56, 19.76, 19.4, 19.0, 17.72, 16.8, 16.68, 16.68, 17.28, 17.16, 16.4, 16.36, 15.68, 15.2, 16.04, 15.72, 15.92, 15.2, 14.96, 14.32, 14.32, 13.72, 13.04, 12.92, 12.8, 12.8, 13.28, 13.24, 13.88, 14.68, 14.92, 14.92, 15.16, 15.68, 16.0, 16.8, 16.88],
# # anti tumoral
#  [199.68, 189.48, 182.64, 176.8, 170.0, 166.0, 158.88, 151.56, 144.28, 136.56, 131.28, 125.04, 118.24, 113.12, 107.96, 103.44, 98.56, 95.16, 91.32, 87.92, 83.64, 79.56, 77.2, 75.0, 73.48, 71.2, 69.4, 68.28, 66.76, 66.12, 64.76, 63.56, 61.52, 60.4, 59.52, 58.28, 56.68, 55.36, 54.24, 53.68, 52.52, 51.96, 49.8, 49.28, 49.08, 48.64, 48.04, 47.8, 47.04, 46.36, 44.84, 44.36, 43.96, 43.32, 42.36, 41.72, 41.24, 41.16, 40.56, 40.64, 40.04, 40.0, 39.72, 39.04, 38.76, 38.68, 38.32, 38.08, 37.36, 37.4, 36.6, 35.16, 34.92, 34.76, 34.8, 34.64, 34.84, 34.16, 34.4, 33.88, 33.52, 33.24, 33.2, 33.08, 33.08, 32.96, 32.28, 31.68, 31.64, 30.84, 30.76, 30.12, 29.68, 29.44, 29.76, 29.92, 29.44, 29.32, 29.68, 30.12],
# # hamiltoniano
# # htme
#  [-138.2544, -134.4416, -129.8488, -116.38719999999999, -106.14040000000001, -112.7376, -113.5952, -115.6796, -112.19040000000001, -114.32520000000001, -115.94800000000001, -125.09200000000001, -119.70480000000002, -117.5116, -119.05040000000001, -114.2872, -115.24719999999999, -115.53720000000001, -116.93360000000001, -116.43360000000001, -115.14040000000001, -114.14480000000002, -119.55239999999999, -126.39280000000001, -126.9932, -131.0232, -125.39400000000002, -118.7968, -122.3648, -120.71719999999999, -123.1768, -123.36, -124.1812, -123.9412, -128.482, -126.7968, -130.126, -129.368, -129.484, -125.9076, -127.9816, -128.7584, -128.5824, -132.3356, -132.41920000000002, -131.4376, -131.81160000000003, -127.4932, -130.5008, -128.90120000000002, -128.77280000000002, -125.3548, -124.124, -124.4144, -129.2516, -127.9392, -131.43, -132.11440000000002, -128.4672, -126.2792, -124.0892, -123.23080000000002, -121.97400000000002, -115.92720000000001, -111.75, -110.0724, -102.5316, -102.5784, -99.94879999999999, -98.51, -93.9724, -93.652, -101.35, -96.7536, -95.9684, -92.5008, -88.5624, -86.6048, -83.792, -89.042, -86.31639999999999, -86.7292, -85.3208, -80.3708, -76.9324, -75.52600000000001, -74.0108, -71.35600000000001, -67.04480000000001, -63.7764, -68.194, -62.274800000000006, -63.86879999999999, -65.96879999999999, -64.9292, -57.5384, -51.033199999999994, -49.0784, -50.303599999999996, -50.8684],
# # pro tumoral
#  [6.7392, 2.5795999999999997, 6.489400000000001, 7.4174, 5.376, 4.7338, 3.8536, 2.2283999999999997, 2.6154, 2.4724, 1.9884, 4.3306000000000004, 2.6188, 1.5074, 2.0224, 1.6844, 2.3444, 2.9856, 5.6172, 4.9376, 3.8698, 3.9488, 5.8376, 6.456999999999999, 5.37, 5.3624, 4.9664, 5.457999999999999, 5.457999999999999, 6.274400000000001, 4.6610000000000005, 5.8958, 7.5894, 8.6476, 7.506, 7.86, 8.7924, 7.2578, 6.1764, 8.006, 9.206800000000001, 9.484399999999999, 12.9438, 12.3124, 13.5498, 13.5218, 13.5238, 10.0678, 11.005, 12.6076, 12.2678, 11.9652, 13.761600000000001, 15.0656, 14.589199999999998, 14.559599999999998, 10.891599999999999, 10.766200000000001, 10.9208, 9.936399999999999, 12.04, 12.806000000000001, 13.818800000000001, 16.4678, 17.4666, 18.984800000000003, 23.896200000000004, 22.529600000000002, 22.211, 23.526799999999998, 24.9208, 26.1418, 22.8694, 25.822999999999997, 29.557799999999997, 29.0444, 28.947200000000002, 28.318599999999996, 31.902599999999996, 28.287200000000002, 29.746399999999998, 28.6364, 29.429000000000002, 31.575, 33.0218, 34.782999999999994, 38.2098, 39.2284, 39.189, 40.0518, 43.3942, 46.933600000000006, 47.475, 45.64240000000001, 48.902800000000006, 53.11820000000001, 57.461400000000005, 60.743199999999995, 61.5972, 64.393],
# # anti tumoral
#  [-144.99360000000001, -137.0212, -136.3382, -123.80460000000001, -111.51639999999999, -117.47139999999999, -117.44879999999999, -117.90799999999999, -114.8058, -116.7976, -117.9364, -129.4226, -122.3236, -119.01899999999999, -121.0728, -115.9716, -117.5916, -118.52279999999999, -122.5508, -121.3712, -119.0102, -118.09360000000001, -125.39, -132.84980000000002, -132.3632, -136.38559999999998, -130.3604, -124.25480000000002, -127.82279999999999, -126.9916, -127.8378, -129.2558, -131.7706, -132.58880000000002, -135.988, -134.6568, -138.9184, -136.6258, -135.66039999999998, -133.9136, -137.1884, -138.24280000000002, -141.52620000000002, -144.648, -145.96900000000002, -144.95940000000002, -145.33540000000002, -137.561, -141.5058, -141.5088, -141.0406, -137.32, -137.88559999999998, -139.48, -143.8408, -142.4988, -142.3216, -142.8806, -139.388, -136.21560000000002, -136.1292, -136.0368, -135.7928, -132.395, -129.2166, -129.0572, -126.4278, -125.10799999999999, -122.15979999999999, -122.0368, -118.8932, -119.7938, -124.21940000000001, -122.5766, -125.5262, -121.54520000000001, -117.50959999999999, -114.9234, -115.6946, -117.3292, -116.06279999999998, -115.3656, -114.7498, -111.9458, -109.9542, -110.309, -112.22059999999999, -110.5844, -106.23380000000002, -103.8282, -111.5882, -109.2084, -111.34379999999999, -111.61120000000001, -113.83200000000001, -110.6566, -108.4946, -109.8216, -111.9008, -115.2614],

# # Fase de escape
# # pro tumoral
#  [11.4, 9.52, 6.84, 4.88, 4.4, 3.48, 3.24, 3.12, 3.12, 3.12, 3.92, 3.32, 3.12, 3.56, 3.52, 3.84, 3.88, 4.28, 3.8, 3.72, 3.88, 4.48, 4.4, 4.48, 4.2, 4.08, 4.12, 4.36, 4.64, 4.2, 4.44, 5.0, 5.0, 4.96, 4.92, 5.36, 5.04, 4.68, 5.16, 5.52, 5.36, 6.04, 5.92, 6.28, 6.16, 6.04, 5.76, 5.96, 6.0, 5.84, 5.84, 6.2, 6.44, 6.28, 6.2, 5.56, 5.8, 5.72, 5.6, 6.24, 6.36, 6.64, 6.72, 6.32, 6.48, 7.04, 6.96, 6.84, 7.08, 7.32, 7.12, 7.16, 7.6, 7.92, 7.92, 7.92, 8.16, 8.84, 8.44, 8.48, 8.12, 8.08, 8.4, 8.4, 8.84, 9.0, 8.92, 9.12, 9.12, 9.64, 9.76, 10.24, 10.04, 10.4, 11.2, 11.64, 12.28, 12.4, 13.04, 13.0],
# # anti tumoral
#  [88.6, 88.0, 85.92, 83.56, 81.92, 80.8, 79.6, 78.8, 77.56, 76.2, 74.44, 73.4, 71.92, 70.24, 69.36, 68.44, 67.6, 65.96, 65.52, 64.96, 64.0, 63.12, 62.2, 61.52, 60.4, 59.68, 58.88, 58.2, 56.8, 56.08, 55.36, 54.68, 54.08, 52.92, 52.32, 51.48, 50.96, 50.28, 49.48, 48.92, 48.24, 47.8, 47.0, 46.2, 45.8, 45.24, 44.68, 43.8, 43.72, 43.4, 43.32, 42.52, 42.08, 41.44, 41.28, 41.04, 40.64, 40.28, 39.6, 38.84, 38.2, 37.88, 37.6, 37.4, 37.16, 37.36, 36.96, 36.68, 36.48, 36.32, 36.08, 35.68, 35.72, 35.24, 34.96, 34.88, 34.16, 33.8, 33.64, 33.84, 33.8, 33.72, 33.96, 33.84, 34.08, 34.04, 34.44, 34.92, 34.8, 34.08, 34.16, 34.2, 34.2, 33.92, 33.36, 33.12, 32.88, 32.96, 32.84, 32.84],
# # hamiltoniano
# # htme
#  [1154.7956, 1259.0888, 1358.0423999999998, 1447.9028, 1563.2676000000001, 1597.5696000000003, 1667.8152000000002, 1607.6844, 1492.9312, 1553.9528, 1539.8612, 1609.2279999999998, 1668.3564, 1730.6384, 1772.9728, 1804.2907999999998, 1847.9923999999999, 1886.5848, 1951.1760000000002, 1991.6136, 2045.0116, 2103.8924, 2137.1232, 2180.1272, 2171.6888, 2172.1564, 2170.8576000000003, 2135.9267999999997, 2140.9452, 2145.3168, 2114.6588, 2155.4592000000002, 2135.5712, 2116.4276, 2193.5176, 2217.6076000000003, 2222.3296, 2187.5628, 2200.2992, 2196.4184, 2208.5764, 2193.7128, 2187.54, 2171.62, 2142.0292, 2130.6588, 2085.0208000000002, 2065.2668, 2030.1112, 1975.5067999999999, 2003.4756, 2001.4536, 1983.2656, 1941.412, 1990.582, 2004.5476, 1991.8836000000001, 1998.7256, 2065.2428, 2055.4364, 2022.75, 1948.4532000000002, 1906.4995999999999, 1896.994, 1862.6236000000001, 1842.6016, 1860.1284, 1869.0508, 1851.9532000000002, 1793.3164000000002, 1811.2060000000001, 1783.3872000000001, 1743.1272, 1740.2051999999999, 1706.256, 1666.2204000000002, 1619.9144000000001, 1583.2432000000001, 1538.0156, 1499.7723999999998, 1509.9596, 1480.3188, 1457.7132000000001, 1455.2060000000001, 1479.0772, 1469.6328, 1529.7644, 1525.7076000000002, 1523.5388, 1499.3236, 1485.2948000000001, 1477.7204000000002, 1484.6752, 1515.9268, 1491.7795999999998, 1507.138, 1517.8080000000002, 1532.9628, 1534.3324, 1538.1228],
# # pro tumoral
#  [1154.7956, 1323.9592000000002, 1476.1916, 1613.8863999999999, 1776.674, 1861.0204, 1951.5644, 1936.4988, 1860.1164, 1937.0523999999998, 1934.3180000000002, 2016.1368, 2072.3216, 2144.4176, 2190.6152, 2218.6356, 2268.95, 2283.7024, 2347.6322, 2397.4474, 2451.0614, 2491.7492, 2515.4224, 2532.6128, 2515.4680000000003, 2512.828, 2507.6278, 2470.294, 2471.6308000000004, 2469.0288, 2430.6204000000002, 2469.7244, 2442.4392000000003, 2419.4236, 2496.2748, 2519.6367999999998, 2520.6816, 2474.4408000000003, 2486.9776, 2474.3896, 2481.142, 2467.4339999999997, 2455.7907999999998, 2443.3252, 2400.9032, 2389.5144, 2338.1908, 2317.45, 2279.0816, 2221.8908, 2246.376, 2237.7792, 2213.1734, 2168.4672, 2213.1312, 2222.5008000000003, 2208.5964000000004, 2210.1584, 2274.8320000000003, 2266.9844, 2228.3848000000003, 2147.5698, 2103.4626000000003, 2096.1642, 2055.1858, 2037.3694, 2054.3396, 2061.749, 2040.0136000000002, 1975.5423999999998, 1994.3624, 1962.5695999999998, 1922.0294000000001, 1914.8594, 1878.9751999999999, 1835.4004, 1786.8242, 1747.2566, 1696.6938, 1663.655, 1672.4607999999998, 1642.8688, 1618.6951999999999, 1618.8816, 1643.6760000000002, 1628.0452000000002, 1679.5985999999998, 1674.3627999999999, 1665.5234000000003, 1639.5514, 1628.5462, 1620.8028, 1625.3178, 1656.1628, 1630.2068, 1644.6168, 1651.7432000000001, 1665.8104, 1663.8508000000002, 1667.4364],
# # anti tumoral
#  [0.0, -64.8704, -118.14920000000001, -165.9836, -213.4064, -263.4508, -283.7492, -328.81440000000003, -367.18519999999995, -383.0996, -394.4568, -406.9088, -403.96520000000004, -413.7792, -417.64239999999995, -414.3448, -420.9576, -397.11760000000004, -396.4562, -405.8338, -406.0498, -387.8568, -378.2992, -352.4856, -343.7792, -340.6716, -336.7702, -334.3672, -330.68559999999997, -323.712, -315.9616, -314.2652, -306.868, -302.996, -302.7572, -302.0292, -298.35200000000003, -286.878, -286.6784, -277.9712, -272.5656, -273.7212, -268.2508, -271.7052, -258.874, -258.85560000000004, -253.17, -252.1832, -248.9704, -246.38400000000001, -242.90040000000002, -236.3256, -229.90780000000004, -227.0552, -222.54919999999998, -217.9532, -216.7128, -211.4328, -209.58919999999998, -211.548, -205.63479999999998, -199.1166, -196.963, -199.1702, -192.56220000000002, -194.7678, -194.2112, -192.69819999999999, -188.06040000000002, -182.226, -183.1564, -179.18240000000003, -178.90220000000002, -174.65420000000003, -172.71920000000003, -169.18, -166.9098, -164.0134, -158.6782, -163.88260000000002, -162.5012, -162.55, -160.982, -163.6756, -164.5988, -158.4124, -149.8342, -148.6552, -141.9846, -140.2278, -143.2514, -143.0824, -140.64260000000002, -140.236, -138.4272, -137.47879999999998, -133.9352, -132.8476, -129.5184, -129.3136]


rmseActual = 100000
i = 0
while (i < 500 and rmseActual > .005):
    i += 1
    params = {"meanIS": mu1,
	  "stdIS": sigma1,
	  "meanCancer": mu2,
	  "stdCancer": sigma2,
      "initial" : f"{title}condInitiales{i}.txt",
      "sameCond" : True
	  }
        # Abrir el archivo en modo de escritura
    with open(f"{title}condInitiales{i}.txt", 'w') as file:
        # Escribir todas las líneas de la lista en el archivo
        file.writelines(str(iniciales))
        
    results = batch_run(
    CancerInmunoediting,
    parameters=params,
    iterations=25, #25
    max_steps=100,
    number_processes=1,
    data_collection_period=1,
    display_progress=True
	)
    
    df = pd.DataFrame(results)
    df_filtered = df[df['Step'] != 0]
    promedio_htme = df_filtered.groupby('Step')['HTME'].mean()
	

    min_len = min(len(promedio_htme), len(res))
    promedio_htme = promedio_htme[:min_len]
    res = res[:min_len]
    
    # Normalizar las listas
    promedio_pc_normalized = promedio_htme
    y_normalized = res
    # Normalizar las listas
    # promedio_pc_normalized = normalize([promedio_pc])
    # y_normalized = normalize([y])
    
    # Calcular el RMSE
    rmse = np.sqrt(np.mean((np.array(promedio_pc_normalized) - np.array(y_normalized))**2))
    
    # print(f'RMSE: {rmse}')
    
    if rmseActual > rmse:
        print(f"Mejor rmse actual {rmse}")
        rmseActual = rmse
        df.to_csv(f"{title}condInitiales{i}.csv")
    else:
        # Nombre del archivo que quieres eliminar (en la ruta actual)
        nombre_archivo = f"{title}condInitiales{i}.txt"
        
        # Verifica si el archivo existe antes de intentar eliminarlo
        if os.path.exists(nombre_archivo):
            # Elimina el archivo
            os.remove(nombre_archivo)
            # print(f"El archivo '{nombre_archivo}' ha sido eliminado.")
        else:
            print(f"El archivo '{nombre_archivo}' no existe.")
    